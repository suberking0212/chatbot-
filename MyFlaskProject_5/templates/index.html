<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Google Fonts çš„ Inter å­—ä½“ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <title>è¯­éŸ³/æ–‡æœ¬èŠå¤©æœºå™¨äººğŸ¤–</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto py-8 px-4 md:px-0">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">é€—åŒ… Dou Bao</h1>
        <div class="flex flex-col md:flex-row gap-4">
            <!-- å¯¹è¯å†å²éƒ¨åˆ† -->
            <div id="conversation-list"
                class="bg-white rounded-lg shadow-md p-6 h-full md:h-screen overflow-y-auto md:w-1/4">
                <h2 class="text-xl font-bold text-gray-700 mb-4">å¯¹è¯å†å²</h2>
                <ul id="conversation-ul">
                    {% for i in range(1, (history|length // 2) + 1) %}
                    <li onclick="loadConversation({{ i }})"
                        class="p-2 border-b border-gray-200 hover:bg-gray-50 cursor-pointer transition duration-200">å¯¹è¯
                        {{ i }}</li>
                    {% endfor %}
                </ul>
            </div>
            <!-- ä¸»å†…å®¹éƒ¨åˆ† -->
            <div id="main-content"
                class="bg-white rounded-lg shadow-md p-6 h-full md:h-screen overflow-y-auto md:w-3/4">
                <!-- æ–‡æœ¬æé—®éƒ¨åˆ† -->
                <h2 class="text-xl font-bold text-gray-700 mb-4">æ–‡æœ¬æé—®</h2>
                <form method="POST" enctype="multipart/form-data" class="mb-8">
                    <label for="text_input" class="block text-sm font-medium text-gray-700">è¯·è¾“å…¥æ‚¨çš„é—®é¢˜ï¼š</label>
                    <textarea name="text_input" id="text_input" placeholder="è¯´ç‚¹ä»€ä¹ˆï½" required
                        class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3 shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea>
                    <div class="mt-4">
                        <label for="language"
                            class="block text-sm font-medium text-gray-700">é€‰æ‹©æœºå™¨äººçš„å›å¤è¯­è¨€ï¼š</label>
                        <select name="language" id="language" required
                            class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3 shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            <option value="zh">ç®€ä½“ä¸­æ–‡</option>
                            <option value="en">English</option>
                            <option value="ja">æ—¥æœ¬èª</option>
                            <option value="fr">FranÃ§ais</option>
                            <option value="ko">í•œêµ­ì–´</option>
                        </select>
                    </div>
                    <div class="mt-4">
                        <label for="voice" class="block text-sm font-medium text-gray-700">é€‰æ‹©è¯­éŸ³éŸ³è‰²ï¼š</label>
                        <select name="voice" id="voice" required
                            class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3 shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            <option value="4189">åº¦æ¶µç«¹</option>
                            <option value="1">åº¦å°ç¾</option>
                            <option value="3">åº¦é€é¥</option>
                            <option value="4">åº¦ä¸«ä¸«</option>
                        </select>
                    </div>
                    <button type="submit"
                        class="mt-4 bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">æäº¤æ–‡æœ¬é—®é¢˜</button>
                </form>
                <!-- è¯­éŸ³æé—®éƒ¨åˆ† -->
                <h2 class="text-xl font-bold text-gray-700 mb-4">è¯­éŸ³æé—®</h2>
                <form method="POST" enctype="multipart/form-data">
                    <label for="file" class="block text-sm font-medium text-gray-700">ä¸Šä¼ è¯­éŸ³æ–‡ä»¶ï¼š</label>
                    <input type="file" name="file" id="file" accept="audio/*" required
                        class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3 shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    <div class="mt-4">
                        <label for="language"
                            class="block text-sm font-medium text-gray-700">é€‰æ‹©å›å¤è¯­è¨€ï¼š</label>
                        <select name="language" id="language" required
                            class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3 shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            <option value="zh">ç®€ä½“ä¸­æ–‡</option>
                            <option value="en">English</option>
                            <option value="ja">æ—¥æœ¬èª</option>
                            <option value="fr">FranÃ§ais</option>
                            <option value="ko">í•œêµ­ì–´</option>
                        </select>
                    </div>
                    <div class="mt-4">
                        <label for="voice" class="block text-sm font-medium text-gray-700">é€‰æ‹©è¯­éŸ³éŸ³è‰²ï¼š</label>
                        <select name="voice" id="voice" required
                            class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3 shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            <option value="4189">åº¦æ¶µç«¹</option>
                            <option value="1">åº¦å°ç¾</option>
                            <option value="3">åº¦é€é¥</option>
                            <option value="4">åº¦ä¸«ä¸«</option>
                        </select>
                    </div>
                    <button type="submit"
                        class="mt-4 bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">æäº¤è¯­éŸ³é—®é¢˜</button>
                </form>
                <!-- æ˜¾ç¤ºå¯¹è¯å†å² -->
                {% if history %}
                <h2 class="text-xl font-bold text-gray-700 mt-8 mb-4">å¯¹è¯å†å²</h2>
                <ul>
                    {% for message in history %}
                    <li class="p-2 border-b border-gray-200"><strong>{{ message.role }}:</strong> {{ message.content }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
                <!-- æ˜¾ç¤ºæœºå™¨äººå›ç­” -->
                {% if text_reply %}
                <h3 class="text-lg font-bold text-gray-700 mt-8 mb-2">æœºå™¨äººå›ç­”ï¼ˆæ–‡å­—ï¼‰ï¼š</h3>
                <p class="p-2 border border-gray-200 rounded-md">{{ text_reply }}</p>
                <h3 class="text-lg font-bold text-gray-700 mt-4 mb-2">æœºå™¨äººå›ç­”ï¼ˆè¯­éŸ³ï¼‰ï¼š</h3>
                <audio controls class="mt-2">
                    <source src="data:audio/mp3;base64,{{ audio_reply }}" type="audio/mp3">
                    oops~æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ’­æ”¾éŸ³é¢‘å‘¢
                </audio>
                {% endif %}
            </div>
        </div>
    </div>
    <script>
        function loadConversation(conversationId) {
            // è¿™é‡Œå¯ä»¥æ·»åŠ åŠ è½½å¯¹è¯å†…å®¹çš„é€»è¾‘ï¼Œæ¯”å¦‚é€šè¿‡ AJAX è¯·æ±‚è·å–å¯¹è¯æ–‡å­—å’Œè¯­éŸ³
            console.log('åŠ è½½å¯¹è¯', conversationId);
        }

        document.addEventListener('contextmenu', function (event) {
            if (event.target.tagName === 'LI') {
                const conversationId = parseInt(event.target.textContent.split(' ')[1]);
                if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¯¹è¯å—ï¼Ÿ')) {
                    fetch(`/delete_conversation/${conversationId}`, {
                        method: 'POST'
                    })
                   .then(response => {
                        if (!response.ok) {
                            throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥');
                        }
                        return response.json();
                    })
                   .then(data => {
                        if (data.message === 'å¯¹è¯å·²åˆ é™¤') {
                            // å¼¹å‡ºæˆåŠŸæç¤ºæ¡†
                            const alertBox = document.createElement('div');
                            alertBox.textContent = 'å·²åˆ é™¤æ­¤æ®µå¯¹è¯';
                            alertBox.classList.add('fixed', 'top-4', 'right-4', 'bg-green-500', 'text-white', 'p-2', 'rounded-md', 'z-50');
                            document.body.appendChild(alertBox);
                            setTimeout(() => {
                                alertBox.remove();
                            }, 2000);
                            // åˆ·æ–°é¡µé¢
                            location.reload();
                        } else {
                            // æ ¹æ®åç«¯è¿”å›çš„é”™è¯¯ä¿¡æ¯æç¤ºç”¨æˆ·
                            alert(data.message);
                        }
                    })
                   .catch(error => {
                        console.error('è¯·æ±‚å‡ºé”™:', error);
                        alert('åˆ é™¤å¯¹è¯æ—¶å‡ºç°ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
                    });
                }
                event.preventDefault();
            }
        });
    </script>
</body>

</html>